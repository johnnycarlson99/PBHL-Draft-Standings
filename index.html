<!DOCTYPE html>
<html>
<head>
<title>PBHL Draft Standings</title>
<meta charset="UTF-8">
<style>
  body {
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  table {
    margin: auto;
    border-collapse: collapse;
    width: 90%;
    font-size: 22px;
  }
  th, td {
    padding: 12px;
    border-bottom: 1px solid #444;
  }
  tr:nth-child(even) { background: #222; }
  th { color: #0af; }
  #error { color: red; margin-top: 20px; }
</style>
</head>
<body>

<h1>PBHL Draft Test Standings (Nov 2025)</h1>
<p>(Auto updates every 60 seconds)</p>

<div id="error"></div>

<table id="standings">
  <tr>
    <th>Rank</th><th>Captain</th><th>Team</th>
    <th>W</th><th>L</th><th>OTL</th>
    <th>Points</th><th>Pts%</th>
  </tr>
</table>

<script>

// Captain â†’ NHL Team ID
const TEAM_MAP = {
  "Johnny": { id: 3, name: "Rangers" },
  "Dan":    { id: 16, name: "Blackhawks" },
  "Grant":  { id: 17, name: "Red Wings" },
  "Ethan":  { id: 54, name: "Vegas" },
  "Mikey":  { id: 19, name: "Blues" },
  "Chris":  { id: 5,  name: "Penguins" },
  "Gage":   { id: 6,  name: "Bruins" },
  "Daz":    { id: 28, name: "Sharks" }
};

// 100% working proxy for NHL API
async function fetchNHLData() {
  const apiUrl =
    "https://statsapi.web.nhl.com/api/v1/schedule?startDate=2025-11-01&endDate=2025-11-30";

  const url = "https://corsproxy.io/?" + encodeURIComponent(apiUrl);

  try {
    const response = await fetch(url);
    const data = await response.json();
    return data.dates || [];
  } catch (err) {
    document.getElementById("error").innerText = "Error loading NHL data.";
    console.error("Proxy/API Error:", err);
    return [];
  }
}


// Compute standings
async function computeStandings() {
  const games = await fetchNHLData();

  let standings = {};
  for (let captain in TEAM_MAP) {
    standings[captain] = {
      captain,
      team: TEAM_MAP[captain].name,
      id: TEAM_MAP[captain].id,
      W: 0, L: 0, OTL: 0, Points: 0, Games: 0
    };
  }

  games.forEach(day => {
    day.games.forEach(game => {
      if (game.status.detailedState !== "Final") return;

      let home = game.teams.home;
      let away = game.teams.away;

      let H = home.team.id;
      let A = away.team.id;

      let homeScore = home.score;
      let awayScore = away.score;

      let wentOT = game.linescore.currentPeriod > 3 || game.linescore.hasShootout;

      for (let captain in standings) {
        let teamId = standings[captain].id;

        if (teamId === H || teamId === A) {

          let winner = homeScore > awayScore ? H : A;
          let loser = homeScore > awayScore ? A : H;

          if (teamId === winner) {
            standings[captain].W++;
            standings[captain].Points += 2;
          } else if (teamId === loser) {
            if (wentOT) {
              standings[captain].OTL++;
              standings[captain].Points++;
